// Chart.js dayjs adapter for v4
(function() {
  'use strict';
  
  if (typeof Chart === 'undefined' || typeof dayjs === 'undefined') {
    return;
  }

  const FORMATS = {
    datetime: 'MMM D, YYYY, h:mm:ss a',
    millisecond: 'h:mm:ss.SSS a',
    second: 'h:mm:ss a',
    minute: 'h:mm a',
    hour: 'hA',
    day: 'MMM D',
    week: 'MMM D',
    month: 'MMM YYYY',
    quarter: '[Q]Q - YYYY',
    year: 'YYYY'
  };

  // Chart.js v4 date adapter constructor
  function DayjsAdapter() {
    this._id = 'dayjs';
  }
  
  DayjsAdapter.prototype.init = function() {
    // Required by Chart.js v4 - initialize the adapter
    return this;
  };
  
  DayjsAdapter.prototype.formats = function() {
    return FORMATS;
  };
  
  DayjsAdapter.prototype.parse = function(value, format) {
    if (value === null || value === undefined) return null;
    
    if (typeof value === 'string' && typeof format === 'string') {
      return dayjs(value, format).valueOf();
    }
    
    if (typeof value === 'string') {
      return dayjs(value).valueOf();
    }
    
    return dayjs(value).valueOf();
  };
  
  DayjsAdapter.prototype.format = function(time, format) {
    try {
      return dayjs(time).format(format);
    } catch (e) {
      return '';
    }
  };
  
  DayjsAdapter.prototype.add = function(time, amount, unit) {
    try {
      return dayjs(time).add(amount, unit).valueOf();
    } catch (e) {
      return time;
    }
  };
  
  DayjsAdapter.prototype.diff = function(max, min, unit) {
    try {
      return dayjs(max).diff(dayjs(min), unit);
    } catch (e) {
      return 0;
    }
  };
  
  DayjsAdapter.prototype.startOf = function(time, unit, weekday) {
    try {
      const d = dayjs(time);
      if (unit === 'isoWeek') {
        return d.startOf('week').valueOf();
      }
      return d.startOf(unit).valueOf();
    } catch (e) {
      return time;
    }
  };
  
  DayjsAdapter.prototype.endOf = function(time, unit) {
    try {
      return dayjs(time).endOf(unit).valueOf();
    } catch (e) {
      return time;
    }
  };

  // Register the adapter constructor with Chart.js v4
  Chart._adapters = Chart._adapters || {};
  Chart._adapters._date = DayjsAdapter;
})();